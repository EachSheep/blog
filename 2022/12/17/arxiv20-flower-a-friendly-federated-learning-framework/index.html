<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>arXiv20-FLOWER: A FRIENDLY FEDERATED LEARNING FRAMEWORK | SHEN Haiyang</title>

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="../../../../favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.jsdelivr.net/gh/inkss/fontawesome@5.15.3/css/all.min.css" rel="stylesheet">

  
  
  
<link rel="stylesheet" href="../../../../css/animate.min.css">

  
<link rel="stylesheet" href="../../../../css/style.css">

  
  
    
<link rel="stylesheet" href="../../../../js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="../../../../js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="../../../../cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="../../../../cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    
        <script src="../../../../js/valine/av-min@3.0.4.js"></script>
        <script src="../../../../https:/cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js"></script>
    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="atom.xml" title="SHEN Haiyang" type="application/atom+xml">
</head>

  
  <!-- 依赖于jquery和vue -->
  <script src="../../../../js/jquery3.5.1.js"></script>
  <script src="../../../../js/vue2.6.11.js"></script>
  
  <body>
    <!-- 预加载动画 -->
    <!-- 页面预加载动画 -->

<div id='loader'>
  <link rel="stylesheet" href="../../../../js/loaded/index.css" >
  <div class="loading-left-bg"></div>
  <div class="loading-right-bg"></div>
  <div class="spinner-box">
    <div class="configure-border-1">
      <div class="configure-core"></div>
    </div>
    <div class="configure-border-2">
      <div class="configure-core"></div>
    </div>
    <div class="loading-word">loading...</div>
  </div>
</div>

<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
  
</script>

    
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 头部导航等 -->
    
<header class="header " id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo lazyload placeholder" src="../../../../medias/logo.png" class="lazyload placeholder" data-srcset="../../../../medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
      <h3 class="drawer-box-head_title">SHEN Haiyang</h3>
      <h5 class="drawer-box-head_desc">SHEN Haiyang is the best!</h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../index.html" class="drawer-menu-item-link">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">Home</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../archives" class="drawer-menu-item-link">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">Archives</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../tags" class="drawer-menu-item-link">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Tags</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../categories" class="drawer-menu-item-link">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">Categories</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../about" class="drawer-menu-item-link">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">About</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../friends" class="drawer-menu-item-link">
                  
                  <span class="name">Friends</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(6)">
                  <span>
                    
                      <i class="fas fa-link"></i>
                    
                    <span class="name">更多</span>
                  </span>
                  <i class="fas fa-chevron-left arrow " :class="{'icon-rotate': isOpen(6)}" aria-hidden="true"></i>
                </a>
                <ul class="drawer-sub-menu" v-if="isOpen(6)">
                  
                  <li>
                    <a href="../../../../gallery">
                      
                      <i class="fas fa-picture-o" style="margin-top: -20px;"></i>
                      
                      <span>Gallery</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="../../../../music">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>Music</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
        
          <li class="drawer-box-content_item">
            <a href="../../../../https:/github.com/hiyoungshen/">
              <i class="fas fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="../../../../medias/logo.png" class="lazyload placeholder" data-srcset="../../../../medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
        </div>
      
      <a href="../../../../index.html" class="logo">SHEN Haiyang</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../index.html" class="menu-item-link" title="Home">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">Home</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../archives" class="menu-item-link" title="Archives">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">Archives</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../tags" class="menu-item-link" title="Tags">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Tags</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../categories" class="menu-item-link" title="Categories">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">Categories</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../about" class="menu-item-link" title="About">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">About</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../friends" class="menu-item-link" title="Friends">
                  
                  <span class="name">Friends</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="javascript:;" class="menu-item-link" title="更多">
                  
                    <i class="fas fa-link"></i>
                  
                  <span class="name">更多</span>
                  <i class="fas fa-chevron-down arrow" aria-hidden="true"></i>
                </a>
                <ul class="sub-menu">
                  
                  <li>
                    <a href="../../../../gallery">
                      
                      <i class="fas fa-picture-o" style="margin-top: -20px;"></i>
                      
                      <span>Gallery</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="../../../../music">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>Music</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">Search</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="Please enter keywords"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="../../../../js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("../../../../search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/hiyoungshen/" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  

    <!-- 当头部导航设置为背景透明的时候  -->
    
      <script src="../../../../js/header/index.js" data-pjax></script>
    
</header>

    <!-- 需要在上面加载的js -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (href, before, media, attributes) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- 轮播图所需要的js -->
<script src="../../../../js/swiper/swiper.min.js"></script>
<script src="../../../../js/swiper/vue-awesome-swiper.js"></script>
<script src="../../../../js/swiper/swiper.animate1.0.3.min.js"></script>


  <script src="../../../../js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="../../../../js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="../../../../https:/cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>


    <!-- 内容区域 -->
    <div id="safearea">
      <main class="main" id="pjax-container" style="margin-top: 0;">
        
 <!-- prismjs 代码高亮 -->
 
    
    <link href="../../../../js/prism/prism-line-numbers.css" rel="stylesheet">
    
        <link href="../../../../js/prism/prism-coy.min.css" rel="stylesheet">
    

    <style>
        pre[class*="language-"] {
            overflow-y: hidden;
        }
        .line-numbers .line-numbers-rows {
            border: none;
        }
    </style>
  


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>

<!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('../../../../medias/4.jpg')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        arXiv20-FLOWER: A FRIENDLY FEDERATED LEARNING FRAMEWORK
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> Published in：2022-12-17 |
        </span>
      

      
        <span class="post-detail-header_categories">
          <i class="iconfont iconbookmark1"></i> category：
          
            <a href="../../../../categories/About-Thesis/" class="post-detail-header_category">
              About Thesis
            </a>
          
        </span>
      

      
    
  </div>
  
  
    <script src="../../../../js/bubble/bubble.js"></script>
  
</div>



<div class="row justify-position">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <h1 id="arXiv20-FLOWER-A-FRIENDLY-FEDERATED-LEARNING-FRAMEWORK"><a href="#arXiv20-FLOWER-A-FRIENDLY-FEDERATED-LEARNING-FRAMEWORK" class="headerlink" title="arXiv20-FLOWER-A-FRIENDLY-FEDERATED-LEARNING-FRAMEWORK"></a>arXiv20-FLOWER-A-FRIENDLY-FEDERATED-LEARNING-FRAMEWORK</h1><p><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217221517671.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217221517671.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221217221517671"></p>
<p><strong>解决的问题</strong>：Although there are a number of research frameworks available to simulate FL algorithms, they do not support <strong>the study of scalable FL workloads</strong> on <strong>heterogeneous edge devices</strong>.</p>
<ul>
<li>FL workloads的可拓展问题。</li>
<li>异构的边缘设备问题。</li>
</ul>
<p><strong>实验的结果</strong>：Our experiments show Flower can perform FL experiments <strong>up to 15M in client size using only a pair of high-end GPUs</strong>. Researchers can then seamlessly migrate experiments to real devices to examine other parts of the design space.</p>
<ul>
<li>仅使用一对高性能的GPU，Flowers可以模拟出15M的client size。</li>
</ul>
<h2 id="Background（当前的框架存在问题）"><a href="#Background（当前的框架存在问题）" class="headerlink" title="Background（当前的框架存在问题）"></a>Background（当前的框架存在问题）</h2><h3 id="当前的框架存在问题："><a href="#当前的框架存在问题：" class="headerlink" title="当前的框架存在问题："></a><strong>当前的框架存在问题</strong>：</h3><ul>
<li><p>TFF、PySyft和LEAF这些框架支持FL算法的小规模的模拟实验，但不支持在<strong>边缘设备上的真实的联邦学习</strong>。</p>
</li>
<li><p>当前的研究很少使用超过100个clients的，即使使用了超过100个，也依赖于模拟而不是实际的实现。<strong>工业上的clients的规模十分的巨大。</strong></p>
<p>  <img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217224332105.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217224332105.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221217224332105"></p>
<ul>
<li>图片显示Flower比FedScale的规模大。</li>
</ul>
</li>
</ul>
<h3 id="Flower（Flower的优点）"><a href="#Flower（Flower的优点）" class="headerlink" title="Flower（Flower的优点）"></a>Flower（Flower的优点）</h3><p>针对这两个问题，<strong>Flower</strong>：</p>
<ul>
<li><strong>在云环境下模拟了真实的设备场景</strong>。Flower provides builtin tools to simulate many of these challenging conditions in a cloud environment and allows for a realistic evaluation of FL algorithms.</li>
<li><strong>scalability考虑的非常好，支持大面积的训练和评测</strong>。Flower is designed with scalability in mind and enables large-cohort research that leverages both a large number of connected clients and a large number of clients training concurrently.</li>
</ul>
<p>具体的说，Flower：</p>
<ul>
<li>支持<strong>真实的设备</strong>、<strong>单节点</strong>和<strong>多节点的计算集群</strong>。（clients的规模可以模拟的很大）</li>
<li><strong>Flower可拓展性好，能够支持新的算法、训练方法和通信代理，模拟和真实设备之间的迁移很丝滑</strong>。</li>
<li>clients上支持各种各样的ML框架。</li>
<li>做了算法和系统的实验，验证了Flower可以将规模拓展到 15million。</li>
</ul>
<p>Flower预先实现的一些算法：</p>
<p><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217225255713.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217225255713.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221217225255713"></p>
<h2 id="Flower（Flower的架构）"><a href="#Flower（Flower的架构）" class="headerlink" title="Flower（Flower的架构）"></a>Flower（Flower的架构）</h2><p><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217225322970.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217225322970.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221217225322970"></p>
<ul>
<li><p>在Server上给一个Stategy指示Server怎么做：client selection、configuration和parameter update aggregation等等。</p>
</li>
<li><p>Client分为真实的Edge Client和模拟出的Virtual Client，真实的Client和Client Manager之间通过Client Manager连接。</p>
</li>
<li><p>Client Manager管理着一系列的Client Proxy，这是Client Manager和Client之间存在的一层中间层，抽象掉Client上使用的不同的ML框架。</p>
</li>
<li><p>Server端包括的components：Client Manager、FL loop和一个用户自定义的Strategy。<strong>服务器端的components</strong>从ClientManager采样clients，<strong>ClientManager</strong>管理着一系列的ClientProxy对象，每一个<strong>ClientProxy对象</strong>表示一个连接到服务器的客户端，这些ClientProxy负责服务器和Clients之间的消息的传递。<strong>FL loop</strong>在FL process的heart，负责协调整个学习的过程。<strong>FL Process</strong>不负责配置、算法，这些<strong>由Stategy负责</strong>。FL loop要求Stategy配置下一轮次的FL，把这些配置发送给对应的clients，接受这些clients的更新，并把聚合的结果返回给Strategy。</p>
</li>
</ul>
<h3 id="Virtual-Client-Engine（核心框架上的一个组件）"><a href="#Virtual-Client-Engine（核心框架上的一个组件）" class="headerlink" title="Virtual Client Engine（核心框架上的一个组件）"></a>Virtual Client Engine（核心框架上的一个组件）</h3><p>a tool that enables the virtualization of Flower Clients to maximise utilization of the available hardware。</p>
<h3 id="Edge-Client-Engine（核心框架上的一个组件）"><a href="#Edge-Client-Engine（核心框架上的一个组件）" class="headerlink" title="Edge Client Engine（核心框架上的一个组件）"></a>Edge Client Engine（核心框架上的一个组件）</h3><ul>
<li>Raspberry Pi或者NVIDIA Jetson这样的设备可以直接当做Flower Clients.</li>
<li>手机这种commodity设备由更严格的、受限的、有时专有的软件栈。为了解决这个问题：<strong>Flower提供了一个low-level的集成（直接处理在Client上的Flower Protocol）</strong>。<strong>没太看懂为什么这样可以解决这样的问题</strong>。</li>
</ul>
<h3 id="Secure-Aggregation（Flower为保护隐私实现的算法）"><a href="#Secure-Aggregation（Flower为保护隐私实现的算法）" class="headerlink" title="Secure Aggregation（Flower为保护隐私实现的算法）"></a>Secure Aggregation（Flower为保护隐私实现的算法）</h3><ul>
<li>实现了SecAgg、SecAgg+。</li>
<li>安全聚合的计算和任何特殊的软件和ML framework无关，对client的dropouts十分的鲁棒、通信和计算的理论瓶颈都很低。</li>
</ul>
<h3 id="FL-Framework-Comparison（和其它FL框架的比较）"><a href="#FL-Framework-Comparison（和其它FL框架的比较）" class="headerlink" title="FL Framework Comparison（和其它FL框架的比较）"></a>FL Framework Comparison（和其它FL框架的比较）</h3><p><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217232626708.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221217232626708.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221217232626708"></p>
<ul>
<li>Single-node simulation: 都支持单节点的模拟。</li>
<li>Multi-node execution: Syft和Flower支持多机器的模拟。FedScale支持多机器的模拟，但不支持实际环境中的部署。TFF计划支持。</li>
<li>Scalability: TFF和LEAF截止写文的时候，只支持单节点，FedScale支持多节点，但是只拓展到了100个并行的clients，Syft支持网络间的通信，但是只能通过连接作为服务器持有数据的clients，限制了scalability。</li>
<li>Heterogeneous clients：Flower支持通过language-agnostic和communication-agnostic实现异构client pool。TFF和Syft需要framework-provided client runtime，FedScale和LEAF集中于Python实现的模拟。</li>
<li>ML framework-agnostic：可以用各种各样的ML framework。TFF和TensorFlow结合，experimentally支持JAX，LEAF也依赖于TensorFlow，Syft和Pytorch以及Keras关系密切。</li>
<li>Language-agnostic：Flower通过使用protocol-level的集成支持多种语言，其它的框架都只支持python。</li>
<li>Baselines：LEAF和FedScale支持大量的Baseline，TFF提供了使用相同的数据集建立baseline的库，Flower当前实现了一些主流的FL Method和ML benchmark。</li>
</ul>
<h2 id="IMPLEMENTATION（各个部件如何实现）"><a href="#IMPLEMENTATION（各个部件如何实现）" class="headerlink" title="IMPLEMENTATION（各个部件如何实现）"></a>IMPLEMENTATION（各个部件如何实现）</h2><p>Flower has an extensive implementation of FL averaging algorithms, a robust communication stack, and various examples of deploying Flower on real and simulated clients.</p>
<h3 id="Communication-stack（通信栈是如何实现的）"><a href="#Communication-stack（通信栈是如何实现的）" class="headerlink" title="Communication stack（通信栈是如何实现的）"></a>Communication stack（通信栈是如何实现的）</h3><ul>
<li>当前的通信协议使用bi-directional <strong>gRPC</strong>实现。</li>
<li><strong>为什么这么实现</strong>：高校的二进制序列化格式在低带宽的手机连接中尤其重要。Bi-directional streaming允许多个message之间的交换，而不会由于重新建立连接导致额外的overhead。</li>
</ul>
<h3 id="Serialization（序列化是如何实现的）"><a href="#Serialization（序列化是如何实现的）" class="headerlink" title="Serialization（序列化是如何实现的）"></a>Serialization（序列化是如何实现的）</h3><ul>
<li>Flower的clients接受源字节序列，然后deserialize指令，然后执行指令。得到的结果序列化发送给server，message的格式和语言无关。</li>
<li><strong>为什么这样实现：</strong>用户可以自定义传输信息的方法。</li>
</ul>
<h3 id="Alternative-communication-stacks（可替代的通信栈）"><a href="#Alternative-communication-stacks（可替代的通信栈）" class="headerlink" title="Alternative communication stacks（可替代的通信栈）"></a>Alternative communication stacks（可替代的通信栈）</h3><ul>
<li>尽管message暂时是用gRPC实现的，但实际上用户可以自定义通信的方法。Flower内部的实现使用了模块化的抽象，因此用户可以自定义gRPC。</li>
</ul>
<h3 id="ClientProxy（客户端代理）"><a href="#ClientProxy（客户端代理）" class="headerlink" title="ClientProxy（客户端代理）"></a>ClientProxy（客户端代理）</h3><ul>
<li>每一个ClientProxy代表一个单独的client，offline的或者不满足要求的client没有ClientProxy。所有SeverSide的逻辑都是依据ClientProxy来实现的。</li>
<li>ClientProxy知识一个抽象的接口，而不是一个实现，因此ClientProxy的实现可以自定义。</li>
</ul>
<h3 id="Virtual-Client-Engine-VCE"><a href="#Virtual-Client-Engine-VCE" class="headerlink" title="Virtual Client Engine (VCE)"></a>Virtual Client Engine (VCE)</h3><ul>
<li>VCE为每一个Client创建一个ClientProxy，但是推迟了实际的Client Object的实例化（包括本地模型和数据）直到需要去执行任务的时候才会去实例化，这样避免了大量的资源的浪费。</li>
<li>VCE在Ray(Moritz et al., 2018)的框架基础上实现，Ray可以序列化client-side的序列化执行，因此可以在通用硬件上做大规模的实现。</li>
</ul>
<h2 id="FRAMEWORK-EVALUATION（框架的实测结果如何）"><a href="#FRAMEWORK-EVALUATION（框架的实测结果如何）" class="headerlink" title="FRAMEWORK EVALUATION（框架的实测结果如何）"></a>FRAMEWORK EVALUATION（框架的实测结果如何）</h2><ul>
<li><strong>Scalability</strong>: We show that Flower can (a) efficiently make use of available resources in single-machine simulations and (b) run experiments with millions of clients whilst sampling thousands in each training.</li>
<li><strong>Heterogeneity</strong>: We show that Flower can be deployed in real, heterogeneous devices commonly found in crossdevice scenario and how it can be used to measure system statistics.</li>
<li><strong>Realism</strong>: We show through a case study how Flower can throw light on the performance of FL under heterogeneous clients with different computational and network capabilities.</li>
<li><strong>Privacy</strong>: Finally, we show how our implementation of Secure Aggregation matches the expected theoretical overhead as expected.</li>
</ul>
<h3 id="Large-Scale-Experiment（验证可以大规模实验）"><a href="#Large-Scale-Experiment（验证可以大规模实验）" class="headerlink" title="Large-Scale Experiment（验证可以大规模实验）"></a>Large-Scale Experiment（验证可以大规模实验）</h3><ul>
<li>任务：五分类任务，使用Amazon Book Review预测User的评分。</li>
<li>模型：finetune了一个Transformer network（DistilBERT model）</li>
<li>数据集：Amazon Book Review Dataset：51M reviews、15Musers。</li>
<li>训练过程中采样的Clients的数量，测试过程中使用两块V100，22-Cores的Intel Xeon Gold 6152(2.10GHz)的CPU。</li>
<li><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218001939134.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218001939134.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221218001939134"><ul>
<li>10-500的收敛都很快，1000的收敛很慢，作者说可能是因为数据的不平衡分布。</li>
</ul>
</li>
</ul>
<h3 id="Single-Machine-Experiments（验证可以帮助研究者快速实现idea，跑得快）"><a href="#Single-Machine-Experiments（验证可以帮助研究者快速实现idea，跑得快）" class="headerlink" title="Single Machine Experiments（验证可以帮助研究者快速实现idea，跑得快）"></a>Single Machine Experiments（验证可以帮助研究者快速实现idea，跑得快）</h3><p>为了证明Flower可以帮助research，能够快速的给出新的idea的结果，Flower needs to be fast at providing reliable results when experimenting new ideas, e.g. a new aggregation strategy。</p>
<ul>
<li>和不同的框架做了个端到端的比较：FedScale，TFF，FedJax和原先的LEAF。</li>
<li>三个FL的设置(Caldas et al., 2018)：FEMNIST数据集。<ul>
<li>number of clients (c) and local epochs per round change (l) 变化的时候，轮次和客户端的数量控制在2000和179.</li>
</ul>
</li>
<li>设备：Intel Xeon E5-2680 CPU (2.40GHz) equipped with two NVIDIA RTX2080 GPUs and 20GB of RAM</li>
</ul>
<p><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218002728311.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218002728311.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221218002728311"></p>
<ul>
<li>c=3,l=1的时候，the overhead of having a multi-task system, like the Virtual Client Engine (VCE), causes Flower to sightly under-perform in comparison to loop-based simulators, like LEAF.</li>
<li>l增加，c增加的时候，这个系统的好处就体现出来了，速度更快。</li>
<li>VCE允许给每一个client指定分配的GPU memory：<ul>
<li>The VCE allows us to specify the amount of GPU memory we want to associate with each client, this allows for more efficient data and model loading of different clients on the same GPU, making the overall training considerably faster.</li>
</ul>
</li>
<li>FedJax在l很小的时候很高效，当通讯成为瓶颈、FedJax的性能稍微下降，FedScale的表现则一直都不是很好。</li>
</ul>
<h3 id="Flower-enables-FL-evaluation-on-real-devices（验证可以在真实设备上跑）"><a href="#Flower-enables-FL-evaluation-on-real-devices（验证可以在真实设备上跑）" class="headerlink" title="Flower enables FL evaluation on real devices（验证可以在真实设备上跑）"></a>Flower enables FL evaluation on real devices（验证可以在真实设备上跑）</h3><h4 id="可以在很多设备上跑"><a href="#可以在很多设备上跑" class="headerlink" title="可以在很多设备上跑"></a>可以在很多设备上跑</h4><p>deploying Flower on six types of heterogeneous real-world mobile and embedded devices, including Java-based <strong>Android smartphones</strong> and Python-based Nvidia <strong>Jetson series devices</strong> and <strong>Raspberry Pi</strong>.</p>
<ul>
<li>FedAvg</li>
<li>云虚拟机上跑。</li>
<li>Python实现的clients</li>
<li>TensorFlow（TensorFlow Lite），While TFLite is primarily designed for on-device inference, we leverage its capabilities to do on-device model personalization to implement a FL client application (Lite, 2020)</li>
</ul>
<p><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218004537772.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218004537772.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221218004537772"></p>
<ul>
<li>DeepConvLSTM</li>
<li>a human activity recognition task on Python-enabled Jetson and Raspberry Pi devices</li>
<li>client上的代码可以不用改就能跑。</li>
<li>启发：By comparing the relative energy consumption and training times across various devices, FL researchers can devise more informed client selection policies that can tradeoff between FL convergence time and overall energy consumption.</li>
</ul>
<h4 id="可以在实际设备上实现细粒度的分析"><a href="#可以在实际设备上实现细粒度的分析" class="headerlink" title="可以在实际设备上实现细粒度的分析"></a>可以在实际设备上实现细粒度的分析</h4><ul>
<li>10 Android clients</li>
<li>2 convolutional layers and 3 fully-connected layers</li>
<li>CIFAR10 dataset</li>
<li>TensorFlow Lite is used as the training ML framework on the devices</li>
<li>We measure the time taken for various FL operations, such as local SGD training, communication between the server and client, local evaluation on the client, and the overhead due to the Flower framework：</li>
<li><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218005254632.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218005254632.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221218005254632"></li>
<li>大部分的时间都是device上的训练时间，Flower整个框架的overhead很小的。</li>
</ul>
<h3 id="Realism-in-Federated-Learning（验证可以帮助研究者开发更好的优化算法）"><a href="#Realism-in-Federated-Learning（验证可以帮助研究者开发更好的优化算法）" class="headerlink" title="Realism in Federated Learning（验证可以帮助研究者开发更好的优化算法）"></a>Realism in Federated Learning（验证可以帮助研究者开发更好的优化算法）</h3><p>举了两个设计样例去验证了一下。</p>
<h4 id="Computational-Heterogeneity-across-Clients"><a href="#Computational-Heterogeneity-across-Clients" class="headerlink" title="Computational Heterogeneity across Clients"></a>Computational Heterogeneity across Clients</h4><p>比如根据Flower上观测的结果去微调了FedAvg算法，牺牲了部分的精度换来了更快的收敛时间。</p>
<h4 id="Heterogeneity-in-Network-Speeds"><a href="#Heterogeneity-in-Network-Speeds" class="headerlink" title="Heterogeneity in Network Speeds"></a>Heterogeneity in Network Speeds</h4><p>客户端的选择策略、通信都会影响训练。</p>
<p><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218010543925.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218010543925.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221218010543925"></p>
<ul>
<li>可以观测到，然后针对性的进行优化。</li>
</ul>
<h3 id="Secure-Aggregation-Overheads"><a href="#Secure-Aggregation-Overheads" class="headerlink" title="Secure Aggregation Overheads"></a>Secure Aggregation Overheads</h3><p>实现了SecAgg和SecAgg+</p>
<p>模型的向量size和clients发生dropouts时候，在服务器端评测了计算和通信开销。we evaluate its impact on server-side computation and communication overhead with the model vector size and clients dropouts。</p>
<ul>
<li>Intel Xeon E-2136 CPU (3.30GHz), with 256 GB of RAM</li>
<li>all entries of our local vectors are of size 24 bits</li>
<li>ignore communication latency</li>
<li>all dropouts simulated happen after stage 2, i.e. Share Keys Stage. This is because this imposes the most significant overhead as the server not only needs to regenerate dropped-out clients’ secrets, but also compute their pairwise masks generated between their neighbours.</li>
<li>the n and t parameters of the t-outof-n secret-sharing scheme are set to 51 and 26,These parameters are chosen to reference SecAgg+’s proven correctness and security guarantees</li>
<li>Fixing the number of sampled clients to 100,</li>
<li>CPU running times through aggregating a vector of size 100k entries to aggregating one of size 500k entries in Figure 8：</li>
<li><img src="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218011017894.png" class="lazyload placeholder" data-srcset="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/image-20221218011017894.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20221218011017894"></li>
</ul>
<h2 id="Conclusion（最终结论）"><a href="#Conclusion（最终结论）" class="headerlink" title="Conclusion（最终结论）"></a>Conclusion（最终结论）</h2>
      </div>
      <div class="post-tags-categories">
        
        <div class="tags">
          
            <a href="../../../../tags/About-Thesis/" class="">
              About Thesis
            </a>
          
            <a href="../../../../tags/About-FL/" class="">
              About FL
            </a>
          
        </div>
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>author:  </strong>hiyoungshen</a>
    </li>
    <li class="post-copyright-link">
    <strong>link:  </strong>
    <a href="/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/" target="_blank" title="arXiv20-FLOWER: A FRIENDLY FEDERATED LEARNING FRAMEWORK">https://hiyoungshen.github.io/2022/12/17/arxiv20-flower-a-friendly-federated-learning-framework/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Copyright notice:   </strong>
      All articles on this website, unless otherwise stated, adopt <a rel="license" href="../../../../https:/creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      reprint policy. If reproduced, please indicate source!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      <!-- 文章详情页的上一页和下一页 -->
<div class="post-nav">





  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="../../../../medias/6.jpg" class="lazyload placeholder" data-srcset="../../../../medias/6.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" src="" alt="">
    </div>
    <a href="../../11/arxiv20-fedml-a-research-library-and-benchmark-for-federated-machine-learning/" class="post-nav-link">
      <div class="title">
        Next: <i class="fas fa-angle-right"></i>
        <div class="title-text">arXiv20-FedML-A Research Library and Benchmark for Federated Machine Learning</div>
      </div>
      <!-- <div class="content">
        arXiv20-FedML-A Research Library and Benchmark for Federated
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-show="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-show="visible">
      <div class="donate-box_close">
        <i class="fas fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          Your appreciation is what keeps me going!
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          支付宝
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          微信
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-show="tabActive === 'Alipay'">
          <img src="../../../../medias/alipay.jpg" class="lazyload placeholder" data-srcset="../../../../medias/alipay.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="支付宝打赏" />
        </div> 
        <div class="WeChatpayImg" v-show="tabActive === 'WeChatpay'">
          <img src="../../../../medias/wechat.jpg" class="lazyload placeholder" data-srcset="../../../../medias/wechat.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="微信打赏" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- 文章详情页的分享 -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script src="../../../../js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
      
<section id="comments" style="padding: 1em; margin: 15px auto;"
	class="animated bounceInUp">
	<div id="vcomment" class="comment"></div>
</section>
<style>
	#comments {
		background: rgba(255,255,255,0.9);
	}
	#veditor {
		background-image: url('../../../../https:/img.zcool.cn/community/01a253594c71cfa8012193a329a77f.gif');
		background-size: contain;
		background-repeat: no-repeat;
		background-position: right;
		background-color: rgba(255, 255, 255, 0);
		resize: vertical;
	}
	#veditor:focus{
		background-position-y: 200px;
		transition: all 0.2s ease-in-out 0s;
	}
	#vcomment .vcards .vcard .vh .vhead .vtag.vvisitor {
		background-color: #42b983;
	}
	.v[data-class=v] .vbtn:active, .v[data-class=v] .vbtn:hover {
		color: #42b983;
		border-color: #42b983;
	}
	#vcomment .vcards .vcard .vhead .vsys i {
		display: none;
	}
	/* 底部valine链接 */
	#vcomment .vpower {
		display: none;
	}
	
	/* 底下注释是修改 名称和邮箱和网址输入框的样式 */
	/* #vcomment .vheader {
		display: flex;
		justify-content: space-around;
	}
	
	#vcomment .vheader .vnick {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vmail {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vlink {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	} */

	img.vimg {
		transition: all 1s;
		/* 头像旋转时间为 1s */
	}

	img.vimg:hover {
		transform: rotate(360deg);
		-webkit-transform: rotate(360deg);
		-moz-transform: rotate(360deg);
		-o-transform: rotate(360deg);
		-ms-transform: rotate(360deg);
	}

	#vcomment .vcards .vcard {
		padding: 15px 20px 0 20px;
		border-radius: 10px;
		margin-bottom: 15px;
		box-shadow: 0 0 4px 1px rgba(0, 0, 0, .12);
		transition: all .3s
	}

	#vcomment .vcards .vcard:hover {
		box-shadow: 0 0 8px 3px rgba(0, 0, 0, .12)
	}

	#vcomment .vcards .vcard .vh .vcard {
		border: none;
		box-shadow: none;
	}
</style>
    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- 目录 -->
  <!-- 文章详情页右侧目录 -->

  <div class="toc-aside">
    <div class="toc-main">
      <div class="toc-aside-title">
        <i class="fas fa-list-ul" aria-hidden="true"></i><span>catalog</span>
        
          <div class="toc-open-close">catalog</div>
        
      </div>
      <div class="toc-content">
        <div class="toc"></div>
      </div>
    </div>
  </div>

  <!-- 手机端目录按钮 -->
  <div id="toc-mobile-btn">
    <i class="fas fa-list-ul" aria-hidden="true"></i>
  </div>
  <!-- js在scripts目录下的的toc.ejs里面 -->
  
    <script>
      if (window.innerWidth >= 992) {
        $(".toc-aside").css({'width': 0, 'padding': 0});
        $(".toc-content").css({'width': 0});
        $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
        $(".main-content").css({'width': '75%', 'margin': '10px auto'});
      }
    </script>
  

  <script>
    function openBtnClickFn () {
      let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
      let open = eval('false' || 'true');
      openOrCloseBtn.click(function() {
        if (open === true) {
          $(".toc-aside").css({'width': 0, 'padding': 0});
          $(".toc-content").css({'width': 0});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
          $(".main-content").css({'width': '75%', 'margin': '10px auto'});
          open = false;
        } else {
          $(".toc-aside").css({'width': '300px', 'padding': '0 10px'});
          $(".toc-content").css({'width': '300px'});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
          $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
          open = true;
        }
      });
    };
    openBtnClickFn();
    document.addEventListener('pjax:complete', function () {
      openBtnClickFn();
    })
    
  </script>


  <!-- 图片放大 Wrap images with fancybox support -->
  <script src="../../../../js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- 页脚 -->
    
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
              
                <a href="../../../../mailto:hiyoungshen@gmail.com" class="social">
                  
                    <i class="fa fa-envelope" aria-hidden="true"></i>
                  
                </a>
              
            
              
                <a href="../../../../https:/github.com/hiyoungshen/" class="social">
                  
                    <i class="fa fa-github" aria-hidden="true"></i>
                  
                </a>
              
            
              
                <a href="../../../../tencent:/AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=253135371" class="social">
                  
                    <i class="fa fa-qq" aria-hidden="true"></i>
                  
                </a>
              
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright © 2021 - 2022 <a target="_blank" rel="noopener" href="https://github.com/hiyoungshen">hiyoungshen</a> | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a> </p>

          </div>
        
      
        
          
            <!-- 不蒜子统计 -->
            <!-- 不蒜子统计 -->
<span id="busuanzi_container_site_pv">
      <i class="fas fa-eye" aria-hidden="true"></i>Total visits：<span id="busuanzi_value_site_pv"></span> times
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fas fa-users" aria-hidden="true"></i>Number of visitors：<span id="busuanzi_value_site_uv"></span> people
</span>

          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- 渲染暗黑按钮 -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fas fa-moon" aria-hidden="true"></i>
    <!-- <span>关灯</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="../../../../js/goTop.js"></script>

    
    <!-- 渲染左下角音乐播放器 -->
    
      <link rel="stylesheet" href="../../../../js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="../../../../https:/cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="../../../../https:/cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    

    <!-- 图片放大 -->
    
      <script src="../../../../js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- 背景彩带 -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="../../../../js/ribbon.min.js"></script>
    

    <script src="../../../../js/utils/index.js"></script>
    <script src="../../../../js/app.js" data-pjax></script>
    
    <!-- 文章目录所需js -->
<link href="../../../../js/tocbot/tocbot.css" rel="stylesheet">
<script src="../../../../js/tocbot/tocbot.min.js"></script>

<script>
  var headerEl = 'h2, h3, h4',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 100) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('toc-aside')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }
</script>

<style>
  .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  }
</style> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('../../../../js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="../../../../js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="../../../../https:/cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
  <script src="../../../../https:/cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="../../../../js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = 'copy';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "Copy Success!",
            content: "The code has been copied. Please comply with the relevant license agreement.",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- 图片懒加载 -->
<script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- 卡片滚动动画 -->
   

<!-- 评论所需js -->

  
    <!-- 弹幕所需的css和js -->
    
<!-- 具体js，请前往valine/script.ejs查看 -->

    <script>
  var requiredFields = 'nick,mail';
  requiredFields = requiredFields.split(',');
  comment_el = '.comment';
  let looperValine = null;
  load_valine = function () {
    if ($(comment_el).length) {
      var valine = new Valine({
        el: '#vcomment',
        path: window.location.pathname,
        notify: false,
        verify: false,
        app_id: "yGxXiiBud4j75xComTe197yA-gzGzoHsz",
        app_key: "kzBVhr6W9sMAwEAz8pi7zrA4",
        placeholder: "客官，说点什么吧",
        avatar: "",
        master: "2cc696926e2ef9ce7d58210c45875a82",   //博主邮箱md5
        tagMeta: ["博主","小伙伴","访客"],     //标识字段名
        friends: "",
        metaPlaceholder: { "nick": "昵称/QQ号", "mail": "邮箱" },
        requiredFields: requiredFields,
        enableQQ: true,
      });
      function debounce(fn) {
        var timerID = null
        return function () {
          var arg = arguments[0]   //获取事件
          if (timerID) {
            clearTimeout(timerID)
          }
          timerID = setTimeout(function () {
            fn(arg)              //事件传入函数
          }, 200)
        }
      }
      //查询评论 valine.Q('*').limit(7) -- 查询所有，限制7条, 下面的的代码是查询当前页面
      var themeDanmu = eval('false');
      var themeLoop = eval('false');
      var themeLooperTime = '5000' || 5000;
      var speed = '40' || 20;
      var isBarrager = true;
      if (themeDanmu == true) {
        do_barrager();
        if ($('.danmuBox').length <= 0) {
          $('.navbar').append('<div class="danmuBox"><div class="danmuBtn open"><span class="danmuCircle"></span><span class="danmuText">弹幕</span></div></div>');
        }
        $('.danmuBtn').on('click', debounce(
          function () {
            if ($('.danmuBtn').hasClass('open')) {
              $('.danmuBtn').removeClass('open')
              clearInterval(looperValine);
              $.fn.barrager.removeAll();
            } else {
              $('.danmuBtn').addClass("open");
              do_barrager();
            }
          }
        ))
      }
      function do_barrager() {
        isBarrager && valine.Q(window.location.pathname).find().then(function (comments) {
          // var num = 0; // 可以记录条数，循环调用的时候只取最新的评论放入弹幕中
          var run_once = true;
          var looper_time = themeLooperTime;
          var total = comments.length;
          // var looper = null;
          var index = 0;
          if (total > 0) {
            barrager();
          } else {
            // 当评论数为0的时候，自动关闭弹幕
            // $('.danmuBtn').removeClass('open');
          }
          function barrager() {
            if (run_once) {
              //如果是首次执行,则设置一个定时器,并且把首次执行置为false
              looperValine = setInterval(barrager, looper_time);
              run_once = false;
            }
            var content = comments[index]._serverData.comment;
            var email = comments[index]._serverData.mail;
            var link = comments[index]._serverData.link;
            var newcontent = content.substring(0, 50).replace(/<[^>]+>/g, "");
            //发布一个弹幕
            const item = {
              img: `https://q1.qlogo.cn/g?b=qq&nk=${email}&s=640`, //图片 
              info: newcontent, //文字 
              href: link, //链接 
              close: true, //显示关闭按钮 
              speed: speed, //延迟,单位秒,默认6 
              color: '#fff', //颜色,默认白色 
              old_ie_color: '#000000', //ie低版兼容色,不能与网页背景相同,默认黑色
            }
            $('body').barrager(item);
            //索引自增
            index++;
            //所有弹幕发布完毕，清除计时器。
            if (index == total) {
              clearInterval(looperValine);
              if (themeLoop === true) {
                setTimeout(function () {
                  do_barrager();
                }, 5000);
              } else {
                $('.danmuBtn').removeClass('open');
              }
              return false;
            }

          }
        })
      }
    }
  };
  $(document).ready(load_valine);
  document.addEventListener('pjax:send', function (e) {
    
  })
  document.addEventListener('pjax:complete', function () {
    load_valine();
  });
</script>

  


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

  
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 999; pointer-events: none;" ></canvas>
    <script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script src="../../../../js/cursor/explosion.min.js"></script>
  




  <script async src="../../../../https:/busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


    <!-- pjax -->
    

<!-- pjax -->


  <script src="../../../../js/pjax@0.2.8/index.js"></script>
  
    <!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>