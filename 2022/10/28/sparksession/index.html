<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <title>SparkSession | SHEN Haiyang</title>

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="../../../../favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.jsdelivr.net/gh/inkss/fontawesome@5.15.3/css/all.min.css" rel="stylesheet">

  
  
  
<link rel="stylesheet" href="../../../../css/animate.min.css">

  
<link rel="stylesheet" href="../../../../css/style.css">

  
  
    
<link rel="stylesheet" href="../../../../js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="../../../../js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="../../../../cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="../../../../cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    
        <script src="../../../../js/valine/av-min@3.0.4.js"></script>
        <script src="../../../../https:/cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js"></script>
    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="atom.xml" title="SHEN Haiyang" type="application/atom+xml">
</head>

  
  <!-- 依赖于jquery和vue -->
  <script src="../../../../js/jquery3.5.1.js"></script>
  <script src="../../../../js/vue2.6.11.js"></script>
  
  <body>
    <!-- 预加载动画 -->
    <!-- 页面预加载动画 -->

<div id='loader'>
  <link rel="stylesheet" href="../../../../js/loaded/index.css" >
  <div class="loading-left-bg"></div>
  <div class="loading-right-bg"></div>
  <div class="spinner-box">
    <div class="configure-border-1">
      <div class="configure-core"></div>
    </div>
    <div class="configure-border-2">
      <div class="configure-core"></div>
    </div>
    <div class="loading-word">loading...</div>
  </div>
</div>

<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
  
</script>

    
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 头部导航等 -->
    
<header class="header " id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo lazyload placeholder" src="../../../../medias/logo.png" class="lazyload placeholder" data-srcset="../../../../medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
      <h3 class="drawer-box-head_title">SHEN Haiyang</h3>
      <h5 class="drawer-box-head_desc">SHEN Haiyang is the best!</h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../index.html" class="drawer-menu-item-link">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">Home</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../archives" class="drawer-menu-item-link">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">Archives</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../tags" class="drawer-menu-item-link">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Tags</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../categories" class="drawer-menu-item-link">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">Categories</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../about" class="drawer-menu-item-link">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">About</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="../../../../friends" class="drawer-menu-item-link">
                  
                  <span class="name">Friends</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="javascript:;" class="drawer-menu-item-link has-children" @click="openOrCloseMenu(6)">
                  <span>
                    
                      <i class="fas fa-link"></i>
                    
                    <span class="name">更多</span>
                  </span>
                  <i class="fas fa-chevron-left arrow " :class="{'icon-rotate': isOpen(6)}" aria-hidden="true"></i>
                </a>
                <ul class="drawer-sub-menu" v-if="isOpen(6)">
                  
                  <li>
                    <a href="../../../../gallery">
                      
                      <i class="fas fa-picture-o" style="margin-top: -20px;"></i>
                      
                      <span>Gallery</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="../../../../music">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>Music</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
        
          <li class="drawer-box-content_item">
            <a href="../../../../https:/github.com/hiyoungshen/">
              <i class="fas fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="../../../../medias/logo.png" class="lazyload placeholder" data-srcset="../../../../medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
        </div>
      
      <a href="../../../../index.html" class="logo">SHEN Haiyang</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../index.html" class="menu-item-link" title="Home">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">Home</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../archives" class="menu-item-link" title="Archives">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">Archives</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../tags" class="menu-item-link" title="Tags">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Tags</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../categories" class="menu-item-link" title="Categories">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">Categories</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../about" class="menu-item-link" title="About">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">About</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="../../../../friends" class="menu-item-link" title="Friends">
                  
                  <span class="name">Friends</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="javascript:;" class="menu-item-link" title="更多">
                  
                    <i class="fas fa-link"></i>
                  
                  <span class="name">更多</span>
                  <i class="fas fa-chevron-down arrow" aria-hidden="true"></i>
                </a>
                <ul class="sub-menu">
                  
                  <li>
                    <a href="../../../../gallery">
                      
                      <i class="fas fa-picture-o" style="margin-top: -20px;"></i>
                      
                      <span>Gallery</span>
                    </a>
                  </li>
                  
                  <li>
                    <a href="../../../../music">
                      
                      <i class="fas fa-music" style="margin-top: -20px;"></i>
                      
                      <span>Music</span>
                    </a>
                  </li>
                  
                </ul>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">Search</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="Please enter keywords"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="../../../../js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("../../../../search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/hiyoungshen/" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  

    <!-- 当头部导航设置为背景透明的时候  -->
    
      <script src="../../../../js/header/index.js" data-pjax></script>
    
</header>

    <!-- 需要在上面加载的js -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (href, before, media, attributes) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- 轮播图所需要的js -->
<script src="../../../../js/swiper/swiper.min.js"></script>
<script src="../../../../js/swiper/vue-awesome-swiper.js"></script>
<script src="../../../../js/swiper/swiper.animate1.0.3.min.js"></script>


  <script src="../../../../js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="../../../../js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="../../../../https:/cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>


    <!-- 内容区域 -->
    <div id="safearea">
      <main class="main" id="pjax-container" style="margin-top: 0;">
        
 <!-- prismjs 代码高亮 -->
 
    
    <link href="../../../../js/prism/prism-line-numbers.css" rel="stylesheet">
    
        <link href="../../../../js/prism/prism-coy.min.css" rel="stylesheet">
    

    <style>
        pre[class*="language-"] {
            overflow-y: hidden;
        }
        .line-numbers .line-numbers-rows {
            border: none;
        }
    </style>
  


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>

<!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('../../../../medias/14.jpg')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        SparkSession
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> Published in：2022-10-28 |
        </span>
      

      
        <span class="post-detail-header_categories">
          <i class="iconfont iconbookmark1"></i> category：
          
            <a href="../../../../categories/About-Experience/" class="post-detail-header_category">
              About Experience
            </a>
          
            <a href="../../../../categories/About-Experience/About-Spark/" class="post-detail-header_category">
              About Spark
            </a>
          
        </span>
      

      
    
  </div>
  
  
    <script src="../../../../js/bubble/bubble.js"></script>
  
</div>



<div class="row justify-position">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <h1 id="A-tale-of-Spark-Session-and-Spark-Context-https-medium-com-achilleus-spark-session-10d0d66d1d24"><a href="#A-tale-of-Spark-Session-and-Spark-Context-https-medium-com-achilleus-spark-session-10d0d66d1d24" class="headerlink" title="A tale of Spark Session and Spark Context(https://medium.com/@achilleus/spark-session-10d0d66d1d24)"></a>A tale of Spark Session and Spark Context(<a target="_blank" rel="noopener" href="https://medium.com/@achilleus/spark-session-10d0d66d1d24">https://medium.com/@achilleus/spark-session-10d0d66d1d24</a>)</h1><p>I have Spark Context, SQL context, Hive context already!</p>
<p><img src="https://miro.medium.com/max/1280/1*aJSwrFLDlDbf9axjJ7gXHw.jpeg" class="lazyload placeholder" data-srcset="https://miro.medium.com/max/1280/1*aJSwrFLDlDbf9axjJ7gXHw.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img"></p>
<p>Spark session is a unified entry point of a spark application from Spark 2.0. It provides a way to interact with various spark’s functionality with a lesser number of constructs. Instead of having a spark context, hive context, SQL context, now all of it is encapsulated in a Spark session.</p>
<h2 id="Some-History…"><a href="#Some-History…" class="headerlink" title="Some History…."></a>Some History….</h2><p>Prior Spark 2.0, Spark Context was the entry point of any spark application and used to access all spark features and needed a sparkConf which had all the cluster configs and parameters to create a Spark Context object. We could primarily create just RDDs using Spark Context and we had to create specific spark contexts for any other spark interactions. For SQL SQLContext, hive HiveContext, streaming Streaming Application. In a nutshell, Spark session is a combination of all these different contexts. Internally, Spark session creates a new SparkContext for all the operations and also all the above-mentioned contexts can be accessed using the SparkSession object.</p>
<h2 id="How-do-I-create-a-Spark-session"><a href="#How-do-I-create-a-Spark-session" class="headerlink" title="How do I create a Spark session?"></a>How do I create a Spark session?</h2><p>A Spark Session can be created using a builder pattern.</p>
<pre class="line-numbers language-none"><code class="language-none">import org.apache.spark.sql.SparkSession
val spark &#x3D; SparkSession.builder
.appName(&quot;SparkSessionExample&quot;) 
.master(&quot;local[4]&quot;) 
.config(&quot;spark.sql.warehouse.dir&quot;, &quot;target&#x2F;spark-warehouse&quot;)
.enableHiveSupport()
.getOrCreate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The spark session builder will try to get a spark session if there is one already created or create a new one and assigns the newly created SparkSession as the global default. Note that <code>enableHiveSupport</code> here is similar to creating a HiveContext and all it does is enables access to Hive metastore, Hive serdes, and Hive udfs.</p>
<p>Note that, we don’t have to create a spark session object when using spark-shell. It is already created for us with the variable <code>**spark**</code>.</p>
<p><img src="https://miro.medium.com/max/60/1*iWGQ3PvMvNy12nmH_eH_8A.png?q=20" class="lazyload placeholder" data-srcset="https://miro.medium.com/max/60/1*iWGQ3PvMvNy12nmH_eH_8A.png?q=20" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img"></p>
<p><img src="https://miro.medium.com/max/875/1*iWGQ3PvMvNy12nmH_eH_8A.png" class="lazyload placeholder" data-srcset="https://miro.medium.com/max/875/1*iWGQ3PvMvNy12nmH_eH_8A.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img"></p>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; spark
res1: org.apache.spark.sql.SparkSession &#x3D; org.apache.spark.sql.SparkSession@2bd158ea<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>We can access spark context and other contexts using the spark session object.</p>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; spark.sparkContext
res2: org.apache.spark.SparkContext &#x3D; org.apache.spark.SparkContext@6803b02dscala&gt; spark.sqlContext
res3: org.apache.spark.sql.SQLContext &#x3D; org.apache.spark.sql.SQLContext@74037f9b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Accessing Spark’s configuration:</p>
<p>We can still access the spark’s configurations using spark session the same way as we used using <code>spark conf</code> .</p>
<h2 id="Why-do-I-need-Spark-session-when-I-already-have-Spark-context"><a href="#Why-do-I-need-Spark-session-when-I-already-have-Spark-context" class="headerlink" title="Why do I need Spark session when I already have Spark context?"></a>Why do I need Spark session when I already have Spark context?</h2><p>A part of the answer would be that it <em>unifies</em> all the <em>different contexts</em> in spark and avoids the developer to worry about creating difference contexts. But apart from this big advantage, the developers of spark have tried to solve the problem when there are multiple users using the same spark context.</p>
<p>Let’s say we have multiple users accessing the same notebook environment which had shared spark context and the requirement was to have an isolated environment sharing the same spark context. Prior to 2.0, the solution to this was to create multiple spark contexts ie spark context per isolated environment or users and is an expensive operation(generally 1 per JVM). But with the introduction of the spark session, this issue has been addressed.</p>
<blockquote>
<p>Note: we can have multiple spark contexts by setting <code>*spark.driver.allowMultipleContexts*</code> to <code>*true*</code> . But having multiple spark contexts in the same jvm is not encouraged and is not considered as a good practice as it makes it more unstable and crashing of 1 spark context can affect the other.</p>
</blockquote>
<h2 id="How-do-I-create-multiple-sessions"><a href="#How-do-I-create-multiple-sessions" class="headerlink" title="How do I create multiple sessions?"></a>How do I create multiple sessions?</h2><p>Spark gives a straight forward API to create a new session which shares the same spark context.<code>spark.newSession()</code> creates a new spark session object. If we look closely at the hash of the <code>spark</code> and <code>session2</code> , they both are different. In contrast, the underneath spark context is the same.</p>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; val session2 &#x3D; spark.newSession()
session2: org.apache.spark.sql.SparkSession &#x3D; org.apache.spark.sql.SparkSession@691fffb9
scala&gt; spark
res22: org.apache.spark.sql.SparkSession &#x3D; org.apache.spark.sql.SparkSession@506bc254scala&gt; spark.sparkContext
res26: org.apache.spark.SparkContext &#x3D; org.apache.spark.SparkContext@715fceafscala&gt; session2.sparkContext
res27: org.apache.spark.SparkContext &#x3D; org.apache.spark.SparkContext@715fceaf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Also, we can verify that the spark session gives a unified view of all the contexts and isolation of configuration and environment. We can directly query without creating a SQL Context like we used and run the queries similarly. Let’s say we have a table called <code>people_session1</code> .This table will be only visible in the session <code>spark</code> . Let’s say we created a new session <code>session2</code> .These tables won’t be visible for when we try to access them and also we can create another table with the same name without affecting the table in <code>spark</code> session.</p>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; people.createOrReplaceTempView(&quot;people_session1&quot;)scala&gt; spark.sql(&quot;show tables&quot;).show()
+--------+---------------+-----------+
|database|      tableName|isTemporary|
+--------+---------------+-----------+
|        |people_session1|       true|
+--------+---------------+-----------+scala&gt; spark.catalog.listTables.show()
+---------------+--------+-----------+---------+-----------+
|           name|database|description|tableType|isTemporary|
+---------------+--------+-----------+---------+-----------+
|people_session1|    null|       null|TEMPORARY|       true|
+---------------+--------+-----------+---------+-----------+scala&gt; session2.sql(&quot;show tables&quot;).show()
+--------+---------+-----------+
|database|tableName|isTemporary|
+--------+---------+-----------+
+--------+---------+-----------+scala&gt;   session2.catalog.listTables.show()
+----+--------+-----------+---------+-----------+
|name|database|description|tableType|isTemporary|
+----+--------+-----------+---------+-----------+
+----+--------+-----------+---------+-----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>This isolation is for the configurations as well. Both sessions can have their own configs.</p>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; spark.conf.get(&quot;spark.sql.crossJoin.enabled&quot;)
res21: String &#x3D; true
scala&gt;   session2.conf.get(&quot;spark.sql.crossJoin.enabled&quot;)
res25: String &#x3D; false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Get-the-existing-configurations"><a href="#Get-the-existing-configurations" class="headerlink" title="Get the existing configurations:"></a>Get the existing configurations:</h2><pre class="line-numbers language-none"><code class="language-none">scala&gt; spark.conf.set(&quot;spark.sql.shuffle.partitions&quot;, 100)scala&gt; spark.conf.getAll
res55: Map[String,String] &#x3D; Map(spark.driver.host -&gt; 19e0778ea843, spark.driver.port -&gt; 38121, spark.repl.class.uri -&gt; spark:&#x2F;&#x2F;19e0778ea843:38121&#x2F;classes, spark.jars -&gt; &quot;&quot;, spark.repl.class.outputDir -&gt; &#x2F;tmp&#x2F;spark-cfe820cd-b2f1-4d23-9c9a-3ee42bc78e01&#x2F;repl-fae1a516-761a-4f31-b957-f5860882478f, spark.sql.crossJoin.enabled -&gt; true, spark.app.name -&gt; Spark shell, spark.ui.showConsoleProgress -&gt; true, spark.executor.id -&gt; driver, spark.submit.deployMode -&gt; client, spark.master -&gt; local[*], spark.home -&gt; &#x2F;opt&#x2F;spark, spark.notebook.name -&gt; SparkSessionSimpleZipExample, spark.sql.catalogImplementation -&gt; hive, spark.app.id -&gt; local-1553489583142, spark.sql.shuffle.partitions -&gt; 100)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="Set-configurations"><a href="#Set-configurations" class="headerlink" title="Set configurations:"></a>Set configurations:</h2><p>To set any configurations, we can either set the configs when we create our spark session using the <code>.config</code> option or use the set method.</p>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; spark.conf.get(&quot;spark.sql.crossJoin.enabled&quot;)
res4: String &#x3D; falsescala&gt; spark.conf.set(&quot;spark.sql.crossJoin.enabled&quot;, &quot;true&quot;)scala&gt; spark.conf.get(&quot;spark.sql.crossJoin.enabled&quot;)
res6: String &#x3D; true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="Some-common-operations"><a href="#Some-common-operations" class="headerlink" title="Some common operations:"></a>Some common operations:</h2><ol>
<li>Create a dataframe from a Seq.</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">val emp &#x3D; Seq((101, &quot;Amy&quot;, Some(2)))
val employee &#x3D; spark.createDataFrame(emp).toDF(&quot;employeeId&quot;,&quot;employeeName&quot;,&quot;managerId&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="2">
<li>Create a Dataset</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; val employeeDs &#x3D; spark.createDataset(emp).as[Employee]
employeeDs: org.apache.spark.sql.Dataset[Employee] &#x3D; [employeeId: int, employeeName: string ... 1 more field]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>3)Read data from a source: Read basically gives access to the dataframe reader which can be used to read from multiple sources such as csv, json, avro, JDBC, and many other 3rd party data source API implementations.</p>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; val df &#x3D; spark.read.option(&quot;header&quot;,&quot;true&quot;).csv(&quot;src&#x2F;main&#x2F;resources&#x2F;Characters.csv&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="4">
<li>Accessing the catalog and listenerManager.</li>
</ol>
<p>The catalog provides information about the underlying databases, tables, functions and lot more for the current session.</p>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; spark.catalog.listColumns(&quot;people_session1&quot;).show
+------+-----------+--------+--------+-----------+--------+
|  name|description|dataType|nullable|isPartition|isBucket|
+------+-----------+--------+--------+-----------+--------+
|    id|       null|     int|   false|      false|   false|
|gender|       null|  string|    true|      false|   false|
| alive|       null| boolean|   false|      false|   false|
+------+-----------+--------+--------+-----------+--------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The listenerManager can be used to register custom QueryExecutionListener for execution metrics. It is still marked as experimental though.</p>
<ol start="5">
<li>Spark implicits</li>
</ol>
<p>Spark session provides with *<strong>spark.implicits._*</strong> which is 1 of the most useful imports in all of the spark packages which comes in handy with a lot of implicit methods for converting Scala objects to Datasets and some other handy utils.</p>
<pre class="line-numbers language-none"><code class="language-none">import spark.implicits.StringToColumn
got.select($&quot;id&quot;)import spark.implicits.symbolToColumn
got.select(&#39;id)import spark.implicits.newProductEncoder
import spark.implicits.localSeqToDatasetHolder
val people &#x3D; Seq((1,&quot;male&quot;,false),(2,&quot;female&quot;,true)).toDF(&quot;id&quot;,&quot;gender&quot;,&quot;alive&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="6">
<li>Create UDF’s</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">val capitalizeAndRemoveSpaces &#x3D; spark.udf.register(&quot;capitalizeAndRemoveSpaces&quot;, capAndRemoveSpaces(_: String): String)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="7">
<li>SQL handler to run SQL queries and a SQL context.</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">spark.sql(&quot;SHOW TABLES&quot;).show
spark.sqlContext.cacheTable(&quot;people_session1&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="8">
<li>Utility method to calculate the time taken to run some function.</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">scala&gt;  spark.time(spark.catalog.cacheTable(&quot;people_session1&quot;))
Time taken: 9 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="9">
<li>The table method gives a way of converting a hive table into a dataframe.</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">val peopleFromTable &#x3D; spark.table(&quot;people_session1&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="10">
<li>The <code>**close**</code> and <code>**stop**</code> methods are provided to stop the underlying spark context.</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; session2.close
scala&gt; session2.sparkContext.isStopped
res5: Boolean &#x3D; true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Also, note that closing/stopping <code>session2</code> will kill <code>spark</code> spark session as well because the underlying spark context is the same.</p>
<pre class="line-numbers language-none"><code class="language-none">scala&gt; spark.sparkContext.isStopped
res6: Boolean &#x3D; true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>As always, Thanks for reading! Please do share the article, if you liked it. Any comments or suggestions are welcome! Check out my other articles <a target="_blank" rel="noopener" href="https://medium.com/@achilleus">*<strong>here*</strong></a>.</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@achilleus?source=post_sidebar--------------------------post_sidebar--------------">achilleus</a></p>
<p>Follow</p>
<p>ACHILLEUS FOLLOWS</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://medium.com/@Pinterest_Engineering?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------"><img src="https://miro.medium.com/fit/c/25/25/1*FNWs-r9nA_QNtBbYvUkAtg.png" class="lazyload placeholder" data-srcset="https://miro.medium.com/fit/c/25/25/1*FNWs-r9nA_QNtBbYvUkAtg.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Pinterest Engineering"></a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@Pinterest_Engineering?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------">Pinterest Engineering</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://alibabatech.medium.com/?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------"><img src="https://miro.medium.com/fit/c/25/25/1*doanyR6AmLHe1ZcnauMrXw.jpeg" class="lazyload placeholder" data-srcset="https://miro.medium.com/fit/c/25/25/1*doanyR6AmLHe1ZcnauMrXw.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Alibaba Tech"></a></p>
<p><a target="_blank" rel="noopener" href="https://alibabatech.medium.com/?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------">Alibaba Tech</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://medium.com/@SeattleDataGuy?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------"><img src="https://miro.medium.com/fit/c/25/25/0*yQUyY8JtXeDsGnPR.jpg" class="lazyload placeholder" data-srcset="https://miro.medium.com/fit/c/25/25/0*yQUyY8JtXeDsGnPR.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="SeattleDataGuy"></a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@SeattleDataGuy?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------">SeattleDataGuy</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://netflixtechblog.medium.com/?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------"><img src="https://miro.medium.com/fit/c/25/25/1*BJWRqfSMf9Da9vsXG9EBRQ.jpeg" class="lazyload placeholder" data-srcset="https://miro.medium.com/fit/c/25/25/1*BJWRqfSMf9Da9vsXG9EBRQ.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Netflix Technology Blog"></a></p>
<p><a target="_blank" rel="noopener" href="https://netflixtechblog.medium.com/?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------">Netflix Technology Blog</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://medium.com/@anicolaspp?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------"><img src="https://miro.medium.com/fit/c/25/25/1*8gSpvHtBZmLTIzZW8dus9g@2x.jpeg" class="lazyload placeholder" data-srcset="https://miro.medium.com/fit/c/25/25/1*8gSpvHtBZmLTIzZW8dus9g@2x.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Nicolas A Perez"></a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@anicolaspp?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------">Nicolas A Perez</a></p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://medium.com/@achilleus/following?source=blogrolls_sidebar-----10d0d66d1d24-----------------------------------">See all (52)</a></p>
<p>847</p>
<p>10</p>
<p><strong>Related</strong></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@chuck.connell.3/databricks-a-history-d8dd12fe9695?source=read_next_recirc---------0-------------------------------"><img src="https://miro.medium.com/focal/73/73/50/50/1*ykuOQuztWYCCANJBc31Uag.jpeg" class="lazyload placeholder" data-srcset="https://miro.medium.com/focal/73/73/50/50/1*ykuOQuztWYCCANJBc31Uag.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img">Databricks — A HistoryWhy was Databricks invented? What came before? What needs does it fill?</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@robin.loche/how-to-work-with-multiple-languages-on-databricks-e22dea9f8c7?source=read_next_recirc---------1-------------------------------"><img src="https://miro.medium.com/focal/73/73/50/50/1*2zpUhCtoN3BTaujGifAxzg.png" class="lazyload placeholder" data-srcset="https://miro.medium.com/focal/73/73/50/50/1*2zpUhCtoN3BTaujGifAxzg.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img">How to work with multiple languages on Databricks</a></p>
<p><a target="_blank" rel="noopener" href="https://fred-gu.medium.com/glue-spark-does-not-like-unsigned-int-from-mysql-2a73249e9c49?source=read_next_recirc---------2-------------------------------"><img src="https://miro.medium.com/focal/73/73/50/50/1*ve2-Te3Rs83Ij6OMrCLnMQ.png" class="lazyload placeholder" data-srcset="https://miro.medium.com/focal/73/73/50/50/1*ve2-Te3Rs83Ij6OMrCLnMQ.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img">Glue spark does not like Unsigned Int from MySQL</a></p>
<p><a target="_blank" rel="noopener" href="https://fnuson.medium.com/calling-synapse-spark-jobs-using-service-principal-3d16c98574db?source=read_next_recirc---------3-------------------------------"><img src="https://miro.medium.com/focal/73/73/50/50/1*zmRmH90BbIGvudggiBZngw.jpeg" class="lazyload placeholder" data-srcset="https://miro.medium.com/focal/73/73/50/50/1*zmRmH90BbIGvudggiBZngw.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img">Calling Synapse Spark Jobs using Service Principal</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://medium.com/tag/spark">Spark</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/tag/big-data">Big Data</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/tag/analytics">Analytics</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/tag/programming">Programming</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/tag/technology">Technology</a></li>
</ul>
<p>847</p>
<p>10</p>
<h2 id="More-from-achilleus"><a href="#More-from-achilleus" class="headerlink" title="More from achilleus"></a><a target="_blank" rel="noopener" href="https://medium.com/@achilleus?source=follow_footer-----10d0d66d1d24-----------------------------------">More from achilleus</a></h2><p>Follow</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@achilleus/a-practical-introduction-to-sparks-column-part-2-1e52f1d29eb1?source=follow_footer-----10d0d66d1d24----0-------------------------------">Mar 23, 2019</a><a target="_blank" rel="noopener" href="https://medium.com/@achilleus/a-practical-introduction-to-sparks-column-part-2-1e52f1d29eb1?source=follow_footer-----10d0d66d1d24----0-------------------------------">A practical introduction to Spark’s Column- part 2</a>This is a continuation of the <a target="_blank" rel="noopener" href="https://medium.com/@achilleus/https-medium-com-achilleus-a-practical-introduction-to-sparks-column-3f5fe83125c9"><em>last article</em></a> wherein I covered some basic and commonly used Column functions. In this post, we will discuss some other common functions available.<a target="_blank" rel="noopener" href="https://medium.com/@achilleus/a-practical-introduction-to-sparks-column-part-2-1e52f1d29eb1?source=follow_footer-----10d0d66d1d24----0-------------------------------"><img src="https://miro.medium.com/max/721/1*4E-Ggod3IRmewV9eTmzlIA.jpeg" class="lazyload placeholder" data-srcset="https://miro.medium.com/max/721/1*4E-Ggod3IRmewV9eTmzlIA.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img"></a>7) castLet’s say you have the below dataset and you want to validate the status based on the start and end date.</p>

      </div>
      <div class="post-tags-categories">
        
        <div class="tags">
          
            <a href="../../../../tags/About-Experience/" class="">
              About Experience
            </a>
          
            <a href="../../../../tags/About-Spark/" class="">
              About Spark
            </a>
          
        </div>
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>author:  </strong>hiyoungshen</a>
    </li>
    <li class="post-copyright-link">
    <strong>link:  </strong>
    <a href="/2022/10/28/sparksession/" target="_blank" title="SparkSession">https://hiyoungshen.github.io/2022/10/28/sparksession/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Copyright notice:   </strong>
      All articles on this website, unless otherwise stated, adopt <a rel="license" href="../../../../https:/creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      reprint policy. If reproduced, please indicate source!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      <!-- 文章详情页的上一页和下一页 -->
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="../../../../medias/1.jpg" class="lazyload placeholder" data-srcset="../../../../medias/1.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="">
    </div>
    <a href="../../../11/06/billion-scale-federated-learning-on-mobile-clients-a-submodel-design-with-tunable-privacy/" class="post-nav-link">
      <div class="title">
        <i class="fas fa-angle-left"></i> Prev:
        <div class="title-text">Billion-Scale Federated Learning on Mobile Clients: A Submodel Design with Tunable Privacy</div>
      </div>
      
      <!-- <div class="content">
        Billion-Scale Federated Learning on Mobile Clients: A Submod
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="../../../../medias/10.jpg" class="lazyload placeholder" data-srcset="../../../../medias/10.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" src="" alt="">
    </div>
    <a href="../web-pa-chong-de-yi-chang-chu-li/" class="post-nav-link">
      <div class="title">
        Next: <i class="fas fa-angle-right"></i>
        <div class="title-text">AWSEMRFilesystem</div>
      </div>
      <!-- <div class="content">
        获取Web数据，撰写爬虫需要处理大量异常不要使用except:try:
    pass
except:
    pas
      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    
      <div id="appDonate" class="post-donate">
  <div id="donate_board" class="donate_bar center" ref="donate">
    <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏" @click="showDialogDrawer()"></a>
  </div>
  <transition name="fade">
    <div 
      class="donate-box-mask"
      v-cloak 
      v-show="visible"
      @click="cancelDialogDrawer()"
    >
    </div>
  </transition>
  <transition name="bounce">
    <div class="donate-box" v-cloak v-show="visible">
      <div class="donate-box_close">
        <i class="fas fa-times" aria-hidden="true" @click="cancelDialogDrawer" pointer></i>
      </div>
      <div class="donate-box_title">
        <h4>
          Your appreciation is what keeps me going!
        </h4>
      </div>
      <div class="donate-box_tab">
        <div class="Alipay" pointer :class="{'active': tabActive === 'Alipay'}" @click="changeTabActive('Alipay')">
          支付宝
        </div>
        <div class="WeChatpay" pointer :class="{'active': tabActive === 'WeChatpay'}" @click="changeTabActive('WeChatpay')">
          微信
        </div>
      </div>
      <div class="donate-box_img">
        <div class="AlipayImg" v-show="tabActive === 'Alipay'">
          <img src="../../../../medias/alipay.jpg" class="lazyload placeholder" data-srcset="../../../../medias/alipay.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="支付宝打赏" />
        </div> 
        <div class="WeChatpayImg" v-show="tabActive === 'WeChatpay'">
          <img src="../../../../medias/wechat.jpg" class="lazyload placeholder" data-srcset="../../../../medias/wechat.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="微信打赏" />
        </div>
      </div>
    </div>
  </transition>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDonate',
    data: {
      visible: false,
      tabActive: 'Alipay',
      top: 0,
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        // function getScroll() {
        //   return {
        //     left: window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0,
        //     top: window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0
        //   };
        // }
        this.top = $(document).scrollTop() // or getScroll().top
        // console.log('aa', $('.main-content'));
        body.style.cssText = 'overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
      changeTabActive(name) {
        this.tabActive = name;
      }
    },
    created() {}
  })
</script>
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- 文章详情页的分享 -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script src="../../../../js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
      
<section id="comments" style="padding: 1em; margin: 15px auto;"
	class="animated bounceInUp">
	<div id="vcomment" class="comment"></div>
</section>
<style>
	#comments {
		background: rgba(255,255,255,0.9);
	}
	#veditor {
		background-image: url('../../../../https:/img.zcool.cn/community/01a253594c71cfa8012193a329a77f.gif');
		background-size: contain;
		background-repeat: no-repeat;
		background-position: right;
		background-color: rgba(255, 255, 255, 0);
		resize: vertical;
	}
	#veditor:focus{
		background-position-y: 200px;
		transition: all 0.2s ease-in-out 0s;
	}
	#vcomment .vcards .vcard .vh .vhead .vtag.vvisitor {
		background-color: #42b983;
	}
	.v[data-class=v] .vbtn:active, .v[data-class=v] .vbtn:hover {
		color: #42b983;
		border-color: #42b983;
	}
	#vcomment .vcards .vcard .vhead .vsys i {
		display: none;
	}
	/* 底部valine链接 */
	#vcomment .vpower {
		display: none;
	}
	
	/* 底下注释是修改 名称和邮箱和网址输入框的样式 */
	/* #vcomment .vheader {
		display: flex;
		justify-content: space-around;
	}
	
	#vcomment .vheader .vnick {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vmail {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	}

	#vcomment .vheader .vlink {
		width: 31%;
		border: 2px solid #dedede;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 5px
	} */

	img.vimg {
		transition: all 1s;
		/* 头像旋转时间为 1s */
	}

	img.vimg:hover {
		transform: rotate(360deg);
		-webkit-transform: rotate(360deg);
		-moz-transform: rotate(360deg);
		-o-transform: rotate(360deg);
		-ms-transform: rotate(360deg);
	}

	#vcomment .vcards .vcard {
		padding: 15px 20px 0 20px;
		border-radius: 10px;
		margin-bottom: 15px;
		box-shadow: 0 0 4px 1px rgba(0, 0, 0, .12);
		transition: all .3s
	}

	#vcomment .vcards .vcard:hover {
		box-shadow: 0 0 8px 3px rgba(0, 0, 0, .12)
	}

	#vcomment .vcards .vcard .vh .vcard {
		border: none;
		box-shadow: none;
	}
</style>
    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- 目录 -->
  <!-- 文章详情页右侧目录 -->

  <div class="toc-aside">
    <div class="toc-main">
      <div class="toc-aside-title">
        <i class="fas fa-list-ul" aria-hidden="true"></i><span>catalog</span>
        
          <div class="toc-open-close">catalog</div>
        
      </div>
      <div class="toc-content">
        <div class="toc"></div>
      </div>
    </div>
  </div>

  <!-- 手机端目录按钮 -->
  <div id="toc-mobile-btn">
    <i class="fas fa-list-ul" aria-hidden="true"></i>
  </div>
  <!-- js在scripts目录下的的toc.ejs里面 -->
  
    <script>
      if (window.innerWidth >= 992) {
        $(".toc-aside").css({'width': 0, 'padding': 0});
        $(".toc-content").css({'width': 0});
        $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
        $(".main-content").css({'width': '75%', 'margin': '10px auto'});
      }
    </script>
  

  <script>
    function openBtnClickFn () {
      let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
      let open = eval('false' || 'true');
      openOrCloseBtn.click(function() {
        if (open === true) {
          $(".toc-aside").css({'width': 0, 'padding': 0});
          $(".toc-content").css({'width': 0});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
          $(".main-content").css({'width': '75%', 'margin': '10px auto'});
          open = false;
        } else {
          $(".toc-aside").css({'width': '300px', 'padding': '0 10px'});
          $(".toc-content").css({'width': '300px'});
          $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
          $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
          open = true;
        }
      });
    };
    openBtnClickFn();
    document.addEventListener('pjax:complete', function () {
      openBtnClickFn();
    })
    
  </script>


  <!-- 图片放大 Wrap images with fancybox support -->
  <script src="../../../../js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- 页脚 -->
    
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
              
                <a href="../../../../mailto:hiyoungshen@gmail.com" class="social">
                  
                    <i class="fa fa-envelope" aria-hidden="true"></i>
                  
                </a>
              
            
              
                <a href="../../../../https:/github.com/hiyoungshen/" class="social">
                  
                    <i class="fa fa-github" aria-hidden="true"></i>
                  
                </a>
              
            
              
                <a href="../../../../tencent:/AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=253135371" class="social">
                  
                    <i class="fa fa-qq" aria-hidden="true"></i>
                  
                </a>
              
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright © 2021 - 2022 <a target="_blank" rel="noopener" href="https://github.com/hiyoungshen">hiyoungshen</a> | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a> </p>

          </div>
        
      
        
          
            <!-- 不蒜子统计 -->
            <!-- 不蒜子统计 -->
<span id="busuanzi_container_site_pv">
      <i class="fas fa-eye" aria-hidden="true"></i>Total visits：<span id="busuanzi_value_site_pv"></span> times
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fas fa-users" aria-hidden="true"></i>Number of visitors：<span id="busuanzi_value_site_uv"></span> people
</span>

          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- 渲染暗黑按钮 -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fas fa-moon" aria-hidden="true"></i>
    <!-- <span>关灯</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="../../../../js/goTop.js"></script>

    
    <!-- 渲染左下角音乐播放器 -->
    
      <link rel="stylesheet" href="../../../../js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="../../../../https:/cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="../../../../https:/cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    

    <!-- 图片放大 -->
    
      <script src="../../../../js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- 背景彩带 -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="../../../../js/ribbon.min.js"></script>
    

    <script src="../../../../js/utils/index.js"></script>
    <script src="../../../../js/app.js" data-pjax></script>
    
    <!-- 文章目录所需js -->
<link href="../../../../js/tocbot/tocbot.css" rel="stylesheet">
<script src="../../../../js/tocbot/tocbot.min.js"></script>

<script>
  var headerEl = 'h2, h3, h4',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 100) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('toc-aside')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }
</script>

<style>
  .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  }
</style> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('../../../../js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="../../../../js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="../../../../https:/cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
  <script src="../../../../https:/cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="../../../../js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = 'copy';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "Copy Success!",
            content: "The code has been copied. Please comply with the relevant license agreement.",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- 图片懒加载 -->
<script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- 卡片滚动动画 -->
   

<!-- 评论所需js -->

  
    <!-- 弹幕所需的css和js -->
    
<!-- 具体js，请前往valine/script.ejs查看 -->

    <script>
  var requiredFields = 'nick,mail';
  requiredFields = requiredFields.split(',');
  comment_el = '.comment';
  let looperValine = null;
  load_valine = function () {
    if ($(comment_el).length) {
      var valine = new Valine({
        el: '#vcomment',
        path: window.location.pathname,
        notify: false,
        verify: false,
        app_id: "yGxXiiBud4j75xComTe197yA-gzGzoHsz",
        app_key: "kzBVhr6W9sMAwEAz8pi7zrA4",
        placeholder: "客官，说点什么吧",
        avatar: "",
        master: "2cc696926e2ef9ce7d58210c45875a82",   //博主邮箱md5
        tagMeta: ["博主","小伙伴","访客"],     //标识字段名
        friends: "",
        metaPlaceholder: { "nick": "昵称/QQ号", "mail": "邮箱" },
        requiredFields: requiredFields,
        enableQQ: true,
      });
      function debounce(fn) {
        var timerID = null
        return function () {
          var arg = arguments[0]   //获取事件
          if (timerID) {
            clearTimeout(timerID)
          }
          timerID = setTimeout(function () {
            fn(arg)              //事件传入函数
          }, 200)
        }
      }
      //查询评论 valine.Q('*').limit(7) -- 查询所有，限制7条, 下面的的代码是查询当前页面
      var themeDanmu = eval('false');
      var themeLoop = eval('false');
      var themeLooperTime = '5000' || 5000;
      var speed = '40' || 20;
      var isBarrager = true;
      if (themeDanmu == true) {
        do_barrager();
        if ($('.danmuBox').length <= 0) {
          $('.navbar').append('<div class="danmuBox"><div class="danmuBtn open"><span class="danmuCircle"></span><span class="danmuText">弹幕</span></div></div>');
        }
        $('.danmuBtn').on('click', debounce(
          function () {
            if ($('.danmuBtn').hasClass('open')) {
              $('.danmuBtn').removeClass('open')
              clearInterval(looperValine);
              $.fn.barrager.removeAll();
            } else {
              $('.danmuBtn').addClass("open");
              do_barrager();
            }
          }
        ))
      }
      function do_barrager() {
        isBarrager && valine.Q(window.location.pathname).find().then(function (comments) {
          // var num = 0; // 可以记录条数，循环调用的时候只取最新的评论放入弹幕中
          var run_once = true;
          var looper_time = themeLooperTime;
          var total = comments.length;
          // var looper = null;
          var index = 0;
          if (total > 0) {
            barrager();
          } else {
            // 当评论数为0的时候，自动关闭弹幕
            // $('.danmuBtn').removeClass('open');
          }
          function barrager() {
            if (run_once) {
              //如果是首次执行,则设置一个定时器,并且把首次执行置为false
              looperValine = setInterval(barrager, looper_time);
              run_once = false;
            }
            var content = comments[index]._serverData.comment;
            var email = comments[index]._serverData.mail;
            var link = comments[index]._serverData.link;
            var newcontent = content.substring(0, 50).replace(/<[^>]+>/g, "");
            //发布一个弹幕
            const item = {
              img: `https://q1.qlogo.cn/g?b=qq&nk=${email}&s=640`, //图片 
              info: newcontent, //文字 
              href: link, //链接 
              close: true, //显示关闭按钮 
              speed: speed, //延迟,单位秒,默认6 
              color: '#fff', //颜色,默认白色 
              old_ie_color: '#000000', //ie低版兼容色,不能与网页背景相同,默认黑色
            }
            $('body').barrager(item);
            //索引自增
            index++;
            //所有弹幕发布完毕，清除计时器。
            if (index == total) {
              clearInterval(looperValine);
              if (themeLoop === true) {
                setTimeout(function () {
                  do_barrager();
                }, 5000);
              } else {
                $('.danmuBtn').removeClass('open');
              }
              return false;
            }

          }
        })
      }
    }
  };
  $(document).ready(load_valine);
  document.addEventListener('pjax:send', function (e) {
    
  })
  document.addEventListener('pjax:complete', function () {
    load_valine();
  });
</script>

  


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

  
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 999; pointer-events: none;" ></canvas>
    <script src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
    <script src="../../../../js/cursor/explosion.min.js"></script>
  




  <script async src="../../../../https:/busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


    <!-- pjax -->
    

<!-- pjax -->


  <script src="../../../../js/pjax@0.2.8/index.js"></script>
  
    <!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>